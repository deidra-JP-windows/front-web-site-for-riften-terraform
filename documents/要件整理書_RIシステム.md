# 要件整理
## 何がしたい？
- ゲームコミュニティ用のWEBサイトとスマホアプリが欲しい
- WEBサイトは外部向けと内部向け両方欲しい
  - 外部向け WEB サイト (Infoサイト) 
    - 誰でもアクセスできる
      - Github Pages を使用
    - リポジトリ内に含まれる 画像をランダムに閲覧できるページ
    - おすすめの再生リストをランダムに表示させるページ
    - 外向けにコミュニティの紹介を行うページ
  - 内部向け WEB サイト (フロントサイト) 
    - コミュニティメンバーのみアクセス可能
      - トークンで認証（ヘッダーにつけて送信）
      - Amazon CloudFront → Amazon S3 からとってくる
        - Lambda@Edge でアクションを制御したい　　AWS Lambda 
      - Discord サーバから以下の情報を収集するのでそれを閲覧したい
        - Discord に投稿された画像へのリンク
        - Discord に投稿された画像の解析とジャンル別まとめ
        - Discord に投稿されたおすすめ動画へのリンク
        - Discord に投稿されたおすすめ動画の解析とジャンル別まとめ
        - Discord に投稿された開発 tips のリンク
        - Discord に投稿された開発 tips の解析とジャンル別まとめ
        - Discord に投稿された募集情報のリンク
        - Discord に作成されている旅行カテゴリの日程
    - バックエンド経由で情報はとってくる
  - 内部向け WEB サイトのバックエンド
    - Discord サーバへ情報が投稿される
    - 内部向け WEB サイト (フロントサイト) に記載されている内容以外だと誕生日の一覧とか？
    - データは Amazon S3 以外には入れない
    - Lambda で実装、フロントからの呼び出しで S3から情報補引っ張ってくる
  - データ投入バッチ
    - AWS Lambdaで動かす。週一とか？
  - トークン認証用 Lambda
    - フロントサイトのログインなどで使用
  - スマホアプリ
    - s3 に保存された募集情報のリンクと旅行カテゴリの日程をカレンダーに表示するアプリ
    - 内部向け WEB サイトのバックエンド経由で情報はとってくる
## 背景は？
- 人数が増えていき、それぞれのニーズの取り込みやユーザ間での交流が限定的になってしまうのではないかと考えたため
- このゲームコミュニティは様々なゲームを遊ぶだけではなく、旅行に行ったり、勉強やソフトウェア開発など行っている
- このゲームコミュニティは Discord 上で運営されている
## 誰が関係している？
- 当該ゲームコミュニティに参加しているユーザ(コミュニティユーザ)
  - 20人ほど
- ページ管理・開発者
  - Discordサーバの開発メンバ
- ページ運用者
  - Discordサーバの開発メンバ
- 管理者
  - Discordサーバの管理者
## コスト感は？
- 可能な限り安く
## アクセス数のイメージは？
- 月間アクセス数は20人が週1回アクセスするくらいのイメージ
## 可用性は？
- 月1h停止くらいで収めたい
- SLA = 99.5% で

## SLA / SLO / SLI

- **SLA（Service Level Agreement／サービスレベル合意）**  
  - 可用性99.5%を保証する。
- **SLO（Service Level Objective／サービスレベル目標）**  
  - 可用性99.7%以上を目標とする（SLAより高めに設定）。
- **SLI（Service Level Indicator／サービスレベル指標）**  
  - CloudFrontの標準アクセスログをJSON形式でS3に出力し、パーティションは`YYYY/MM/DD`で日次分割。
  - 監視頻度は週1回とし、過去のログデータは一週間ごとに削除。
  - 週次バッチでAthenaクエリを実行し、可用性（例：HTTP 2xx/3xx応答率）を集計。
  - クエリ結果はExcel形式でS3に保存し、必要に応じてExcelのスクリーンショットを共有（Excelが開けない場合の配慮）。
  - 例: Athenaクエリ
    ```sql
    SELECT
      date_trunc('day', request_time) AS day,
      COUNT(*) AS total_requests,
      SUM(CASE WHEN status_code BETWEEN 200 AND 399 THEN 1 ELSE 0 END) AS success_requests,
      ROUND(100.0 * SUM(CASE WHEN status_code BETWEEN 200 AND 399 THEN 1 ELSE 0 END) / COUNT(*), 2) AS availability_percent
    FROM
      cloudfront_logs_json_partitioned
    WHERE
      year = '2025'
    GROUP BY
      day
    ORDER BY
      day;
    ```
  - この結果をもとに、SLO/SLAの達成状況を定期的に確認する。

### SLI詳細・監視運用方針
- **アベイラビリティSLI**: `(2xx + 3xx) / 全リクエスト`
- **レイテンシSLI**: パーセンタイル（例: p95, p99）で「レスポンス1秒以下の割合」を評価する案もあるが、今回は「1秒以下のリクエスト / 全体リクエスト」とする。
- **監視・可視化**: 本来はQuickSightやDataDog, NewRelic等の統合監視サービスでリアルタイム可視化・アラートが望ましいが、低コスト運用を優先し、Athena＋Excel＋手動/スクショ共有で対応。
- **アラート運用**: 5xx系・4xx系エラーが全体リクエストの5割を超えた場合、最低限の対応としてDiscordにアラート通知を行う。
## 期間は？
- 開発期間は6か月を目途
  - 6人月を当該コミュニティ管理者とその他ユーザで分割する
